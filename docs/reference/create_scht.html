<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>SCHT creation for large datasets with enhanced features — create_scht • ScIsoX</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="SCHT creation for large datasets with enhanced features — create_scht"><meta name="description" content="Creates a Single-Cell Hierarchical Tensor from raw count data
with efficient operations for large-scale datasets. Supports
pre-normalized data and comprehensive QC tracking."><meta property="og:description" content="Creates a Single-Cell Hierarchical Tensor from raw count data
with efficient operations for large-scale datasets. Supports
pre-normalized data and comprehensive QC tracking."><meta property="og:image" content="https://ThaddeusWu.github.io/ScIsoX/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-#1a5490" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ScIsoX</a>

    <small class="nav-text text-success me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/vignette-01-getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-02-data-import-qc.html">Data Import and QC</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-03-complexity-metrics.html">Complexity Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-04-visualisation.html">Visualisation Gallery</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-05-coexpression.html">Co-expression Analysis</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ThaddeusWu/ScIsoX/releases/tag/v1.1.3">Version 1.1.3</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ThaddeusWu/ScIsoX/releases/tag/v1.1.2">Version 1.1.2</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ThaddeusWu/ScIsoX/releases/tag/v1.1.1">Version 1.1.1</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ThaddeusWu/ScIsoX/releases/tag/V1.1.0">Version 1.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ThaddeusWu/ScIsoX/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SCHT creation for large datasets with enhanced features</h1>
      <small class="dont-index">Source: <a href="https://github.com/ThaddeusWu/ScIsoX/blob/HEAD/R/create_scht.R" class="external-link"><code>R/create_scht.R</code></a></small>
      <div class="d-none name"><code>create_scht.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a Single-Cell Hierarchical Tensor from raw count data
with efficient operations for large-scale datasets. Supports
pre-normalized data and comprehensive QC tracking.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_scht</span><span class="op">(</span></span>
<span>  <span class="va">gene_counts</span>,</span>
<span>  <span class="va">transcript_counts</span>,</span>
<span>  <span class="va">transcript_info</span>,</span>
<span>  cell_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_hvg <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  qc_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min_genes_per_cell <span class="op">=</span> <span class="fl">200</span>, max_genes_per_cell <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>    min_cells_expressing <span class="op">=</span> <span class="fl">0.02</span>, min_expr <span class="op">=</span> <span class="fl">1e-04</span><span class="op">)</span>,</span>
<span>  require_cell_type <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sparsity_threshold <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  input_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw_counts"</span>, <span class="st">"normalised"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-gene-counts">gene_counts<a class="anchor" aria-label="anchor" href="#arg-gene-counts"></a></dt>
<dd><p>Gene-level counts as matrix, data frame, or sparse matrix.
Row names can be either gene IDs (e.g., ENSG00000000001) or gene names (e.g., GAPDH).
The function automatically detects which format is used and handles both appropriately.</p></dd>


<dt id="arg-transcript-counts">transcript_counts<a class="anchor" aria-label="anchor" href="#arg-transcript-counts"></a></dt>
<dd><p>Transcript-level counts as matrix, data frame, or sparse matrix</p></dd>


<dt id="arg-transcript-info">transcript_info<a class="anchor" aria-label="anchor" href="#arg-transcript-info"></a></dt>
<dd><p>Data frame with transcript annotations</p></dd>


<dt id="arg-cell-info">cell_info<a class="anchor" aria-label="anchor" href="#arg-cell-info"></a></dt>
<dd><p>Optional data frame with cell metadata</p></dd>


<dt id="arg-n-hvg">n_hvg<a class="anchor" aria-label="anchor" href="#arg-n-hvg"></a></dt>
<dd><p>Number of highly variable genes to select</p></dd>


<dt id="arg-qc-params">qc_params<a class="anchor" aria-label="anchor" href="#arg-qc-params"></a></dt>
<dd><p>QC parameters list</p></dd>


<dt id="arg-require-cell-type">require_cell_type<a class="anchor" aria-label="anchor" href="#arg-require-cell-type"></a></dt>
<dd><p>Whether cell type information is required</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Whether to show progress</p></dd>


<dt id="arg-sparsity-threshold">sparsity_threshold<a class="anchor" aria-label="anchor" href="#arg-sparsity-threshold"></a></dt>
<dd><p>Minimum sparsity to use sparse representation (0-1)</p></dd>


<dt id="arg-input-type">input_type<a class="anchor" aria-label="anchor" href="#arg-input-type"></a></dt>
<dd><p>Type of input data: "raw_counts" or "normalised" (e.g., TPM, FPKM)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An SCHT or IntegratedSCHT object with the following attributes:</p><ul><li><p><code>performance</code>: List containing performance metrics:</p><ul><li><p><code>total_time_sec</code>: Total processing time in seconds</p></li>
<li><p><code>memory_used_mb</code>: Memory utilised in megabytes</p></li>
</ul></li>
<li><p><code>preprocessing</code>: List containing QC statistics and enhanced QC report</p></li>
<li><p><code>creation_date</code>: Timestamp of object creation</p></li>
<li><p><code>package_version</code>: Version of ScIsoX used</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gene_counts_blood</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">transcript_counts_blood</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">transcript_info</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sample2stage</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Basic SCHT creation with default parameters</span></span></span>
<span class="r-in"><span><span class="va">scht_basic</span> <span class="op">&lt;-</span> <span class="fu">create_scht</span><span class="op">(</span></span></span>
<span class="r-in"><span>  gene_counts <span class="op">=</span> <span class="va">gene_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_counts <span class="op">=</span> <span class="va">transcript_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_info <span class="op">=</span> <span class="va">transcript_info</span>,</span></span>
<span class="r-in"><span>  cell_info <span class="op">=</span> <span class="va">sample2stage</span>,</span></span>
<span class="r-in"><span>  n_hvg <span class="op">=</span> <span class="fl">2000</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting SCHT creation with matrix support...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input type: raw_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking package dependencies...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 0: Processing input data and converting to optimal format...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input processing complete (2.29 sec). Memory usage: 419.50 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Gene counts matrix: 55487 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Transcript counts matrix: 142238 rows x 205 cols (sparse)</span>
<span class="r-plt img"><img src="create_scht-1.png" alt="" width="768" height="576"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Auto-detected QC parameters using three strategies:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   MAD Strategy: min=980, max=13756 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 90: min=4106, max=10648 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 80: min=4474, max=9663 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 1: Performing initial quality control...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Initial QC complete (0.45 sec). Memory usage: 453.90 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 37606 genes and 0 transcripts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 2: Filtering poor-quality cells...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell QC complete (0.38 sec). Memory usage: 453.90 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 0 cells, 205 remaining</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 3: Performing CPM normalisation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CPM normalisation complete (0.38 sec). Memory usage: 484.00 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 4: Performing log2 transformation...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matrix format after log transform:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(gene_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(gene_mat)   = 17881, 205 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(transcript_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(transcript_mat)   = 142238, 205 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Log2 transformation complete (0.39 sec). Memory usage: 514.10 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 5: Selecting highly variable genes...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selecting top highly variable genes (HVGs)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of genes considered after min cell filter: 17881</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 2000 highly variable genes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVG selection complete (0.37 sec). Memory usage: 514.10 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 2000 highly variable genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 6: Creating isoform matrices for HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering transcripts to only those belonging to HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of input var_genes: 2000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of unique gene names in transcript_info: 77922</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting to standard matrices...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created isoform matrices for 1296 genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with single isoform: 670 (removed)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with multiple isoforms: 1296 (kept)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Isoform matrix creation complete (18.36 sec). Memory usage: 516.20 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created matrices for 1296 genes with multiple isoforms</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 7: Building the final SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT structure building complete (0.38 sec). Memory usage: 516.30 MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> === Sparsity Analysis for Current Dataset ===</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Original Transcript Matrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 55,487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 142,238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 2,457,789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 26,701,001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 29,158,790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 91.57%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Filtered Transcript Matrix (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 1,296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 4,927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 49,787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 960,248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 1,010,035</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 95.07%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3. SCHT Structure (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 49,787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 106,585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 156,372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 68.16%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4. Naive 3D Tensor (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Required dimensions: 1,296 x 27 x 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 49,787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 7,123,573</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 7,173,360</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 99.31%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5. Zero Elements Avoided by SCHT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Original Matrix: 26,594,416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Filtered Matrix: 853,663</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Naive 3D Tensor: 7,016,988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6. Memory Efficiency Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 0.54% of original matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 15.48% of filtered matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 2.18% of naive tensor size</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 8: Generating cell type-specific SCHT structures...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell type-specific structure generation complete (0.50 sec). Memory usage: 520.80 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 9: Creating integrated SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Integration complete (0.36 sec). Memory usage: 520.80 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT creation completed successfully in 25.77 seconds (0.43 minutes)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Memory utilised: 520.80 MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Examine the structure</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scht_basic</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Integrated SCHT Object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =====================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Original SCHT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Single-Cell Hierarchical Tensor (SCHT) object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of genes: 1296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of transcripts: 4927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean isoforms per gene: 3.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall sparsity: 68.2 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matrix storage type: matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cell type-specific analysis:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of cell types: 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cell Types: AEC, HEC, T1_pre_HSC, T2_pre_HSC, E12, E14, Adult_HSC </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Created: 2025-09-28 19:52:12</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scht_basic</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Integrated SCHT Summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Original SCHT Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SCHT Object Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> --------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Genes: 1296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total transcripts: 4927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Mean isoforms: 3.80</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preprocessing Info:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   HVGs selected: 2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   QC-filtered genes: 37606</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   QC-filtered transcripts: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   QC-filtered cells: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data characteristics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 68.2%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Created: 2025-09-28 19:52:09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cell type-specific Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    cell_type n_genes n_cells</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        AEC     809      18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        HEC    1142      24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 T1_pre_HSC    1048      26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 T2_pre_HSC     944      38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        E12     845      21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        E14     799      32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  Adult_HSC     954      44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performance metrics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total processing time: 25.77 seconds (0.43 minutes)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory utilised: 520.80 MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Note: The actual number of cells for each gene may vary from the shown n_cells,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as cells with no expression for specific genes are removed from their respective matrices.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> This cell-wise filtering is performed independently for each gene to maintain data quality</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> and avoid spurious zero expressions in the cell type-specific analyses.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Using recommended QC parameters</span></span></span>
<span class="r-in"><span><span class="co"># First, get QC recommendations</span></span></span>
<span class="r-in"><span><span class="va">qc_recommendations</span> <span class="op">&lt;-</span> <span class="fu"><a href="recommend_qc_parameters.html">recommend_qc_parameters</a></span><span class="op">(</span><span class="va">gene_counts_blood</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">qc_recommendations</span><span class="op">$</span><span class="va">explanation</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "MAD_strategy: Uses median +/- 3 MAD, reduces risk of including poor quality cells whilst maintaining robustness to outliers"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "Interval_90: Uses 5th and 95th percentiles, balances stringency with dataset preservation"                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "Interval_80: Uses 10th and 90th percentiles, provides more aggressive filtering for higher quality cell selection"          </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use the moderate (90% interval) strategy</span></span></span>
<span class="r-in"><span><span class="va">recommended_params</span> <span class="op">&lt;-</span> <span class="va">qc_recommendations</span><span class="op">$</span><span class="va">Interval_90</span></span></span>
<span class="r-in"><span><span class="co"># Add the missing parameters</span></span></span>
<span class="r-in"><span><span class="va">recommended_params</span><span class="op">$</span><span class="va">min_cells_expressing</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span></span>
<span class="r-in"><span><span class="va">recommended_params</span><span class="op">$</span><span class="va">min_expr</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">scht_recommended</span> <span class="op">&lt;-</span> <span class="fu">create_scht</span><span class="op">(</span></span></span>
<span class="r-in"><span>  gene_counts <span class="op">=</span> <span class="va">gene_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_counts <span class="op">=</span> <span class="va">transcript_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_info <span class="op">=</span> <span class="va">transcript_info</span>,</span></span>
<span class="r-in"><span>  cell_info <span class="op">=</span> <span class="va">sample2stage</span>,</span></span>
<span class="r-in"><span>  n_hvg <span class="op">=</span> <span class="fl">1500</span>,</span></span>
<span class="r-in"><span>  qc_params <span class="op">=</span> <span class="va">recommended_params</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting SCHT creation with matrix support...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input type: raw_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking package dependencies...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 0: Processing input data and converting to optimal format...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input processing complete (0.66 sec). Memory usage: 45.40 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Gene counts matrix: 55487 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Transcript counts matrix: 142238 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Auto-detected QC parameters using three strategies:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   MAD Strategy: min=980, max=13756 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 90: min=4106, max=10648 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 80: min=4474, max=9663 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 1: Performing initial quality control...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Initial QC complete (0.44 sec). Memory usage: 79.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 37606 genes and 0 transcripts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 2: Filtering poor-quality cells...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell QC complete (0.38 sec). Memory usage: 120.30 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 22 cells, 183 remaining</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 3: Performing CPM normalisation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CPM normalisation complete (0.38 sec). Memory usage: 147.40 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 4: Performing log2 transformation...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matrix format after log transform:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(gene_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(gene_mat)   = 17881, 183 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(transcript_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(transcript_mat)   = 142238, 183 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Log2 transformation complete (0.39 sec). Memory usage: 174.40 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 5: Selecting highly variable genes...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selecting top highly variable genes (HVGs)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of genes considered after min cell filter: 17114</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1500 highly variable genes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVG selection complete (0.38 sec). Memory usage: 174.50 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1500 highly variable genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 6: Creating isoform matrices for HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering transcripts to only those belonging to HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of input var_genes: 1500</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of unique gene names in transcript_info: 77922</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting to standard matrices...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created isoform matrices for 925 genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with single isoform: 546 (removed)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with multiple isoforms: 925 (kept)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Isoform matrix creation complete (13.01 sec). Memory usage: 175.70 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created matrices for 925 genes with multiple isoforms</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 7: Building the final SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT structure building complete (0.38 sec). Memory usage: 175.70 MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> === Sparsity Analysis for Current Dataset ===</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Original Transcript Matrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 55,487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 142,238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 2,457,789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 26,701,001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 29,158,790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 91.57%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Filtered Transcript Matrix (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 925</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 3,282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 26,813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 573,793</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 600,606</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 95.54%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3. SCHT Structure (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 26,813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 51,715</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 78,528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 65.86%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4. Naive 3D Tensor (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Required dimensions: 925 x 21 x 183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 26,813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 3,527,962</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 3,554,775</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 99.25%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5. Zero Elements Avoided by SCHT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Original Matrix: 26,649,286</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Filtered Matrix: 522,078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Naive 3D Tensor: 3,476,247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6. Memory Efficiency Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 0.27% of original matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 13.07% of filtered matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 2.21% of naive tensor size</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 8: Generating cell type-specific SCHT structures...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell type-specific structure generation complete (0.45 sec). Memory usage: 178.50 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 9: Creating integrated SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Integration complete (0.37 sec). Memory usage: 178.50 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT creation completed successfully in 18.24 seconds (0.30 minutes)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Memory utilised: 178.50 MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Manual QC parameters for different experimental designs</span></span></span>
<span class="r-in"><span><span class="co"># For high-depth sequencing or full-length protocols</span></span></span>
<span class="r-in"><span><span class="va">scht_manual</span> <span class="op">&lt;-</span> <span class="fu">create_scht</span><span class="op">(</span></span></span>
<span class="r-in"><span>  gene_counts <span class="op">=</span> <span class="va">gene_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_counts <span class="op">=</span> <span class="va">transcript_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_info <span class="op">=</span> <span class="va">transcript_info</span>,</span></span>
<span class="r-in"><span>  cell_info <span class="op">=</span> <span class="va">sample2stage</span>,</span></span>
<span class="r-in"><span>  n_hvg <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  qc_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    min_genes_per_cell <span class="op">=</span> <span class="fl">4000</span>,       </span></span>
<span class="r-in"><span>    max_genes_per_cell <span class="op">=</span> <span class="fl">10000</span>,      </span></span>
<span class="r-in"><span>    min_cells_expressing <span class="op">=</span> <span class="fl">0.02</span>,   </span></span>
<span class="r-in"><span>    min_expr <span class="op">=</span> <span class="fl">1e-6</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting SCHT creation with matrix support...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input type: raw_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking package dependencies...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 0: Processing input data and converting to optimal format...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input processing complete (0.65 sec). Memory usage: 45.30 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Gene counts matrix: 55487 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Transcript counts matrix: 142238 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Auto-detected QC parameters using three strategies:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   MAD Strategy: min=980, max=13756 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 90: min=4106, max=10648 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 80: min=4474, max=9663 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 1: Performing initial quality control...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Initial QC complete (0.44 sec). Memory usage: 79.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 37606 genes and 0 transcripts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 2: Filtering poor-quality cells...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell QC complete (0.38 sec). Memory usage: 118.80 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 24 cells, 181 remaining</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 3: Performing CPM normalisation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CPM normalisation complete (0.38 sec). Memory usage: 145.10 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 4: Performing log2 transformation...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matrix format after log transform:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(gene_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(gene_mat)   = 17881, 181 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(transcript_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(transcript_mat)   = 142238, 181 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Log2 transformation complete (0.39 sec). Memory usage: 171.20 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 5: Selecting highly variable genes...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selecting top highly variable genes (HVGs)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of genes considered after min cell filter: 16903</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1000 highly variable genes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVG selection complete (0.39 sec). Memory usage: 171.30 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1000 highly variable genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 6: Creating isoform matrices for HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering transcripts to only those belonging to HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of input var_genes: 1000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of unique gene names in transcript_info: 77922</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting to standard matrices...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created isoform matrices for 624 genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with single isoform: 355 (removed)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with multiple isoforms: 624 (kept)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Isoform matrix creation complete (8.71 sec). Memory usage: 172.00 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created matrices for 624 genes with multiple isoforms</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 7: Building the final SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT structure building complete (0.38 sec). Memory usage: 172.00 MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> === Sparsity Analysis for Current Dataset ===</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Original Transcript Matrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 55,487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 142,238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 2,457,789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 26,701,001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 29,158,790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 91.57%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Filtered Transcript Matrix (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 624</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 2,154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 15,397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 374,477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 389,874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 96.05%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3. SCHT Structure (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 15,397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 26,703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 42,100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 63.43%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4. Naive 3D Tensor (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Required dimensions: 624 x 21 x 181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 15,397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 2,356,427</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 2,371,824</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 99.35%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5. Zero Elements Avoided by SCHT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Original Matrix: 26,674,298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Filtered Matrix: 347,774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Naive 3D Tensor: 2,329,724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6. Memory Efficiency Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 0.14% of original matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 10.80% of filtered matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 1.78% of naive tensor size</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 8: Generating cell type-specific SCHT structures...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell type-specific structure generation complete (0.42 sec). Memory usage: 173.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 9: Creating integrated SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Integration complete (0.37 sec). Memory usage: 173.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT creation completed successfully in 13.91 seconds (0.23 minutes)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Memory utilised: 173.60 MB</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4: Working with normalised data</span></span></span>
<span class="r-in"><span><span class="co"># If your data is already normalised (TPM/FPKM)</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">scht_normalised</span> <span class="op">&lt;-</span> <span class="fu">create_scht</span><span class="op">(</span></span></span>
<span class="r-in"><span>  gene_counts <span class="op">=</span> <span class="va">gene_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_counts <span class="op">=</span> <span class="va">transcript_counts_blood</span>,</span></span>
<span class="r-in"><span>  transcript_info <span class="op">=</span> <span class="va">transcript_info</span>,</span></span>
<span class="r-in"><span>  cell_info <span class="op">=</span> <span class="va">sample2stage</span>,</span></span>
<span class="r-in"><span>  n_hvg <span class="op">=</span> <span class="fl">1500</span>,</span></span>
<span class="r-in"><span>  input_type <span class="op">=</span> <span class="st">"normalised"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting SCHT creation with matrix support...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input type: normalised</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking package dependencies...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 0: Processing input data and converting to optimal format...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input processing complete (0.67 sec). Memory usage: 45.30 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Gene counts matrix: 55487 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Transcript counts matrix: 142238 rows x 205 cols (sparse)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Auto-detected QC parameters using three strategies:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   MAD Strategy: min=980, max=13756 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 90: min=4106, max=10648 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Interval 80: min=4474, max=9663 genes per cell</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 1: Performing initial quality control...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Initial QC complete (0.44 sec). Memory usage: 79.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 37606 genes and 0 transcripts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 2: Filtering poor-quality cells...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell QC complete (0.38 sec). Memory usage: 79.60 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtered 0 cells, 205 remaining</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 3: Skipping CPM normalisation (data already normalised)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 4: Performing log2 transformation...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matrix format after log transform:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(gene_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(gene_mat)   = 17881, 205 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class(transcript_mat) = dgCMatrix </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    dim(transcript_mat)   = 142238, 205 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Log2 transformation complete (0.39 sec). Memory usage: 109.70 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 5: Selecting highly variable genes...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selecting top highly variable genes (HVGs)...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of genes considered after min cell filter: 17881</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1500 highly variable genes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVG selection complete (0.38 sec). Memory usage: 109.80 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selected 1500 highly variable genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 6: Creating isoform matrices for HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering transcripts to only those belonging to HVGs...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of input var_genes: 1500</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of unique gene names in transcript_info: 77922</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting to standard matrices...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created isoform matrices for 912 genes</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with single isoform: 559 (removed)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> HVGs with multiple isoforms: 912 (kept)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Isoform matrix creation complete (13.58 sec). Memory usage: 111.10 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created matrices for 912 genes with multiple isoforms</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 7: Building the final SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT structure building complete (0.39 sec). Memory usage: 111.10 MB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> === Sparsity Analysis for Current Dataset ===</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Original Transcript Matrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 55,487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 142,238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 2,457,789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 26,701,001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 29,158,790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 91.57%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Filtered Transcript Matrix (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of genes: 912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of isoforms: 3,334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of cells: 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 29,566</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 653,904</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 683,470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 95.67%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3. SCHT Structure (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 29,566</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 58,606</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 88,172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 66.47%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4. Naive 3D Tensor (Post-QC HVG):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Required dimensions: 912 x 14 x 205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Non-zero elements: 29,566</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Zero elements: 2,587,874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Total elements: 2,617,440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sparsity: 98.87%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5. Zero Elements Avoided by SCHT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Original Matrix: 26,642,395</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Filtered Matrix: 595,298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vs Naive 3D Tensor: 2,529,268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6. Memory Efficiency Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 0.30% of original matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 12.90% of filtered matrix size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   SCHT uses only 3.37% of naive tensor size</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 8: Generating cell type-specific SCHT structures...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cell type-specific structure generation complete (0.46 sec). Memory usage: 113.90 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Step 9: Creating integrated SCHT structure...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Integration complete (0.38 sec). Memory usage: 113.90 MB</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> SCHT creation completed successfully in 18.44 seconds (0.31 minutes)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Memory utilised: 113.90 MB</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 5: Accessing SCHT components</span></span></span>
<span class="r-in"><span><span class="co"># Get list of cell types</span></span></span>
<span class="r-in"><span><span class="va">cell_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scht_basic</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cell_types</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "original_results"   "cell_type_matrices"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access specific cell type data</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="st">"AEC"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cell_types</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">aec_data</span> <span class="op">&lt;-</span> <span class="va">scht_basic</span><span class="op">[[</span><span class="st">"AEC"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"AEC dimensions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">aec_data</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">" x "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get highly variable genes used</span></span></span>
<span class="r-in"><span><span class="va">hvgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scht_basic</span>, <span class="st">"hvg_genes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hvgs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Total HVGs:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hvgs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Total HVGs: 0"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check transcript usage per gene</span></span></span>
<span class="r-in"><span><span class="va">transcript_usage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scht_basic</span>, <span class="st">"transcript_gene_map"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">transcript_usage</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Siyuan Wu, Ulf Schmitz<br> Site built with <a href="https://pkgdown.r-lib.org" class="external-link">pkgdown</a> 2.1.1</p>
</div>

<div class="pkgdown-footer-right">
  <p><strong>Package License</strong>: <a href="https://opensource.org/licenses/MIT" class="external-link">MIT</a><br><br><strong>Example Data Attribution</strong>:<br> The example datasets included in this package are derived from:<br> Wang et al. (2022). Single-cell architecture and functional requirement of alternative splicing during hematopoietic stem cell formation. <em>Science Advances</em> 8(1):eabg5369<br> Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC BY 4.0</a><br> We gratefully acknowledge the authors for making their data publicly available.</p>
</div>

    </footer></div>





  </body></html>

